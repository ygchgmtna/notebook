
# PyTorch `nn.Conv2d()` å…¨é¢ä»‹ç»

ä¸‹é¢æ˜¯å¯¹ `nn.Conv2d()` çš„è¯¦ç»†ä»‹ç»ï¼Œæ¶µç›–å…¶ **ä½œç”¨ã€å‚æ•°ã€åŸç†ã€ç¤ºä¾‹ã€è®¡ç®—å…¬å¼ã€ä¸ Linear çš„å¯¹æ¯”** ç­‰å†…å®¹ã€‚

---

## âœ… ä¸€ã€`nn.Conv2d()` æ˜¯ä»€ä¹ˆï¼Ÿ

`nn.Conv2d` æ˜¯ PyTorch ä¸­ç”¨äºå®šä¹‰ **äºŒç»´å·ç§¯å±‚** çš„å‡½æ•°ï¼Œå¸¸ç”¨äºå›¾åƒå¤„ç†ä»»åŠ¡ï¼ˆè¾“å…¥ä¸ºå›¾ç‰‡æˆ–ç‰¹å¾å›¾ï¼‰ã€‚

å®ƒæ‰§è¡Œå¦‚ä¸‹çš„å·ç§¯æ“ä½œï¼š

```math
	ext{output}(C_{out}, H_{out}, W_{out}) = \sum_{C_{in}} 	ext{input}(C_{in}) * 	ext{kernel}(C_{in}, C_{out})
```

å…¶ä¸­ `*` è¡¨ç¤ºå·ç§¯æ“ä½œã€‚

---

## ğŸ”§ äºŒã€å‡½æ•°å®šä¹‰ä¸å‚æ•°

```python
torch.nn.Conv2d(in_channels, out_channels, kernel_size, stride=1, padding=0,
                dilation=1, groups=1, bias=True, padding_mode='zeros')
```

| å‚æ•°å         | è¯´æ˜ |
|----------------|------|
| `in_channels`  | è¾“å…¥é€šé“æ•°ï¼ˆå¦‚ RGB å›¾åƒä¸º 3ï¼‰ |
| `out_channels` | å·ç§¯æ ¸ä¸ªæ•°ï¼Œè¾“å‡ºç‰¹å¾å›¾é€šé“æ•° |
| `kernel_size`  | å·ç§¯æ ¸å°ºå¯¸ï¼Œæ•´æ•°æˆ– `(kH, kW)` |
| `stride`       | æ­¥é•¿ï¼Œé»˜è®¤ 1 |
| `padding`      | å¡«å……å¤§å°ï¼Œæ§åˆ¶è¾“å‡ºå°ºå¯¸ |
| `dilation`     | æ‰©å¼ å·ç§¯ç”¨ï¼Œé»˜è®¤ 1 |
| `groups`       | åˆ†ç»„å·ç§¯ç”¨ï¼Œé»˜è®¤ 1 |
| `bias`         | æ˜¯å¦åŒ…å«åç½®é¡¹ |
| `padding_mode` | å¡«å……æ–¹å¼ï¼ˆ'zeros', 'reflect', 'replicate', 'circular'ï¼‰ |

---

## ğŸ“ ä¸‰ã€è¾“å‡ºå°ºå¯¸è®¡ç®—å…¬å¼

è®¾ï¼š

- è¾“å…¥å°ºå¯¸ï¼š\( H_{in} \times W_{in} \)
- å·ç§¯æ ¸å°ºå¯¸ï¼š\( K_H \times K_W \)
- å¡«å……ï¼š\( P \)
- æ­¥é•¿ï¼š\( S \)

è¾“å‡ºå°ºå¯¸è®¡ç®—ä¸ºï¼š

```math
H_{out} = \left\lfloor \frac{H_{in} + 2P - K_H}{S} + 1 \right\rfloor
W_{out} = \left\lfloor \frac{W_{in} + 2P - K_W}{S} + 1 \right\rfloor
```

---

## ğŸ“˜ å››ã€ç®€å•ç¤ºä¾‹

```python
import torch
import torch.nn as nn

conv = nn.Conv2d(in_channels=3, out_channels=16, kernel_size=3, stride=1, padding=1)
x = torch.randn(1, 3, 32, 32)  # (batch, channels, height, width)
y = conv(x)
print(y.shape)  # torch.Size([1, 16, 32, 32])
```

---

## ğŸ“¦ äº”ã€æƒé‡å’Œåç½®å‚æ•°

```python
conv.weight.shape  # torch.Size([out_channels, in_channels, kH, kW])
conv.bias.shape    # torch.Size([out_channels])
```

é»˜è®¤ä¼šåˆå§‹åŒ–æ‰€æœ‰å‚æ•°ï¼Œå¯ä»¥é€šè¿‡ `torch.nn.init` è¿›è¡Œè‡ªå®šä¹‰åˆå§‹åŒ–ã€‚

---

## ğŸ§ª å…­ã€å¸¸è§ç”¨é€”

| åœºæ™¯           | ç”¨æ³•ç¤ºä¾‹                       |
|----------------|--------------------------------|
| ç‰¹å¾æå–       | å›¾åƒè¾“å…¥ â†’ å·ç§¯ â†’ æ± åŒ–         |
| å·ç§¯ç¥ç»ç½‘ç»œ   | CNN çš„åŸºç¡€æ„å»ºå•å…ƒ             |
| å›¾åƒåˆ†å‰²       | ä½œä¸º encoder + decoder æ¶æ„     |
| æ³¨æ„åŠ›æœºåˆ¶     | ç”¨äºç”Ÿæˆ query/key/value å›¾     |

---

## ğŸ” ä¸ƒã€ä¸ `nn.Linear()` çš„å¯¹æ¯”

| æ¯”è¾ƒé¡¹       | `nn.Conv2d`                        | `nn.Linear`                  |
|--------------|-------------------------------------|------------------------------|
| è¾“å…¥ç»´åº¦     | 4D: (N, C_in, H, W)                | 2D: (N, features)            |
| è¿æ¥æ–¹å¼     | å±€éƒ¨è¿æ¥ï¼Œå‚æ•°å…±äº«                | å…¨è¿æ¥                      |
| å‚æ•°æ•°é‡     | ç›¸å¯¹å°‘ï¼ˆå…±äº«å·ç§¯æ ¸ï¼‰              | ç›¸å¯¹å¤š                      |
| ç”¨é€”         | å›¾åƒå¤„ç†ã€ç‰¹å¾æå–                | ç‰¹å¾æ˜ å°„ã€åˆ†ç±»              |
| å¯è§†åŒ–æ€§     | å¯ä»¥å¯è§†åŒ–å·ç§¯æ ¸ã€æ¿€æ´»å›¾          | ä¸æ˜“å¯è§†åŒ–                  |

---

## ğŸ§¬ å…«ã€æŸ¥çœ‹æ¢¯åº¦ä¸æƒé‡æ›´æ–°

```python
conv = nn.Conv2d(3, 16, 3, padding=1)
input = torch.randn(2, 3, 32, 32)
output = conv(input)
loss = output.sum()
loss.backward()

print(conv.weight.grad.shape)  # æŸ¥çœ‹æƒé‡æ¢¯åº¦
```

---

## âœ… ä¹ã€æ€»ç»“

| ç‚¹ä½     | å†…å®¹è¯´æ˜                            |
|----------|-------------------------------------|
| æœ¬è´¨     | å±€éƒ¨è¿æ¥çš„æ»‘åŠ¨çª—å£ä¹˜åŠ æ“ä½œ          |
| å‚æ•°     | é€šé“æ•°ã€å·ç§¯æ ¸å¤§å°ã€æ­¥é•¿ã€å¡«å……ç­‰    |
| å¸¸è§ç”¨é€” | CNNã€åˆ†å‰²ã€æ£€æµ‹ã€æ³¨æ„åŠ› QKV æ˜ å°„     |
| ä¸ Linear | å‚æ•°æ›´å°‘ï¼Œé€‚åˆç»“æ„åŒ–æ•°æ®å¦‚å›¾åƒ       |

---

å¦‚ä½ å¸Œæœ›è¿›ä¸€æ­¥äº†è§£ `Conv2d` çš„åå‘ä¼ æ’­è¿‡ç¨‹ã€å¯è§†åŒ–æŠ€å·§æˆ–æ­å»ºå®Œæ•´ CNN ç½‘ç»œï¼Œä¹Ÿå¯ä»¥ç»§ç»­æé—®ï¼
